<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>cubes</title>
    <style media="screen">
      body {margin:0}
    </style>
  </head>
  <body>
    <script type="text/javascript" src="sylvester.js"></script>
    <script type="text/javascript">


function createRenderer(){

  var w = window.innerWidth,
      h = window.innerHeight,
      s = Math.min(w,h)

  var c = document.createElement('canvas')

  c.width = w
  c.height = h
  document.body.appendChild(c)

  var ctx = c.getContext('2d')
  ctx.translate(w/2,h/2)
  ctx.lineCap = 'round'
  ctx.lineWidth = s/60
  ctx.strokeStyle = 'rgba(0,0,0,0.9)'

  var clear = ctx.clearRect.bind(ctx, -w/2, -h/2, w, h)

  var base = $M([
    [s/4,0,0],
    [0,s/4,0],
    [0,0,s/4]
  ])

  return {
    draw: function (vertices) {

      var vs = vertices.map(function(v){
        return base.multiply(v)
      })

      ctx.beginPath()

      for (var i = 0; i < vs.length; i+=2) {
        var a = vs[i]
        var b = vs[i+1]

        ctx.moveTo(a.e(1), a.e(2))
        ctx.lineTo(b.e(1), b.e(2))

      }
      ctx.stroke()
    },
    clear: ctx.clearRect.bind(ctx, -w/2, -h/2, w, h),
    canvas: c
  }
}


var renderer = createRenderer()

var _cube = [

  [-1,-1,-1], [ 1,-1,-1],
  [-1,-1,-1], [-1, 1,-1],
  [-1,-1,-1], [-1,-1, 1],

  [-1, 1, 1], [ 1, 1, 1],
  [-1, 1, 1], [-1,-1, 1],
  [-1, 1, 1], [-1, 1,-1],

  [ 1, 1,-1], [-1, 1,-1],
  [ 1, 1,-1], [ 1,-1,-1],
  [ 1, 1,-1], [ 1, 1, 1],

  [ 1,-1, 1], [-1,-1, 1],
  [ 1,-1, 1], [ 1, 1, 1],
  [ 1,-1, 1], [ 1,-1,-1]

]
.map($V)


function transform(scale, rx, ry) {
  var m = $M([
      [scale,0,0],
      [0,scale,0],
      [0,0,scale]
    ])
    .multiply(Matrix.RotationX(ry))
    .multiply(Matrix.RotationY(rx))
  return m.multiply.bind(m)
}

function cube(s, rx, ry){
  return _cube
    .map(
      transform(
        s,
        rx,
        ry
      )
    )
}


var c = renderer.canvas

c.addEventListener("touchstart", function(e){
  e.preventDefault()
}, false);
c.addEventListener("touchmove", function(e){
  e.preventDefault()

  renderer.clear()

  var r = 1
  var touches = e.touches
  for (var i = 0; i < touches.length; i++) {
    renderer.draw(cube(
      r,
      touches[i].pageX/100,
      touches[i].pageY/100
    ))

  }

}, false);


var cubes = []

document.addEventListener('mousemove', function(e){

  cubes[e.buttons] = [e.screenX/100, e.screenY/100]

  renderer.clear()
  cubes.forEach(function(coords, i) {
    renderer.draw(cube(1,coords[0],coords[1]))
  })

})


    </script>
  </body>
</html>
