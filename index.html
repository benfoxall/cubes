<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>cubes</title>
    <style media="screen">
      body {margin:0}
    </style>
  </head>
  <body>
    <script type="text/javascript" src="sylvester.js"></script>
    <script type="text/javascript">

var w = window.innerWidth,
    h = window.innerHeight,
    s = Math.min(w,h)

var c = document.createElement('canvas')
c.width = w
c.height = h

document.body.appendChild(c)

var ctx = c.getContext('2d')
ctx.translate(w/2,h/2)
ctx.lineCap = 'round'
ctx.lineWidth = s/60
ctx.strokeStyle = 'rgba(0,0,0,0.9)'

var clear = ctx.clearRect.bind(ctx, -w/2, -h/2, w, h)

var base = $M([
  [s/4,0,0],
  [0,s/4,0],
  [0,0,s/4]
])

var _cube = [

  [-1,-1,-1], [ 1,-1,-1],
  [-1,-1,-1], [-1, 1,-1],
  [-1,-1,-1], [-1,-1, 1],

  [-1, 1, 1], [ 1, 1, 1],
  [-1, 1, 1], [-1,-1, 1],
  [-1, 1, 1], [-1, 1,-1],

  [ 1, 1,-1], [-1, 1,-1],
  [ 1, 1,-1], [ 1,-1,-1],
  [ 1, 1,-1], [ 1, 1, 1],

  [ 1,-1, 1], [-1,-1, 1],
  [ 1,-1, 1], [ 1, 1, 1],
  [ 1,-1, 1], [ 1,-1,-1]

]
.map($V)


function transform(base, scale, rx, ry) {
  var m = $M([
      [scale,0,0],
      [0,scale,0],
      [0,0,scale]
    ])
    .multiply(base)
    .multiply(Matrix.RotationX(ry))
    .multiply(Matrix.RotationY(rx))
  return m.multiply.bind(m)
}


function draw(vertices){
  ctx.beginPath()

  for (var i = 0; i < vertices.length; i+=2) {
    var a = vertices[i]
    var b = vertices[i+1]

    ctx.moveTo(a.e(1), a.e(2))
    ctx.lineTo(b.e(1), b.e(2))

  }
  ctx.stroke()
}

function drawCube(s, rx, ry){
  draw(
    _cube
      .map(
        transform(
          base,
          s,
          rx,
          ry
        )
      )
  )
}


c.addEventListener("touchstart", function(e){
  e.preventDefault()
}, false);
c.addEventListener("touchmove", function(e){
  e.preventDefault()

  clear()

  var r = 1
  var touches = e.touches
  for (var i = 0; i < touches.length; i++) {

    drawCube(
      r,
      touches[i].pageX/100,
      touches[i].pageY/100
    )

  }

}, false);



document.addEventListener('mousemove', function(e){
  clear()

  drawCube(
    1,
    e.screenX/100,
    e.screenY/100
  )

})



    </script>
  </body>
</html>
